@model StaffWeb.Models.StaffAppointmentViewModel
@{
    ViewData["Title"] = "Tạo lịch khám";
}

<section class="card">
    <h1 class="page-title">Tạo lịch khám trực tiếp</h1>
    <p class="page-subtitle">Nhập thông tin cơ bản để tạo lịch.</p>

    @if (TempData["Success"] != null)
    {
        <div class="alert">@TempData["Success"]</div>
    }
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert">Kiểm tra lại thông tin bắt buộc.</div>
    }

    <form method="post" id="appointmentForm">
        <input type="hidden" name="action" id="actionField" value="" />
        <div class="form-row">
            <div>
                <label>Ngày giờ khám</label>
                <input asp-for="VisitTime" type="datetime-local" id="visitTimeInput" />
            </div>
            <div>
                <label>Mã thú cưng</label>
                <input asp-for="PetId" />
            </div>
            <div>
                <label>Dịch vụ</label>
                <select asp-for="ServiceId">
                    <option value="">Chọn dịch vụ</option>
                    @foreach (var dv in Model.Services)
                    {
                        <option value="@dv.madv">@dv.tendv</option>
                    }
                </select>
            </div>
            <div>
                <label>Bác sĩ</label>
                <select asp-for="DoctorId">
                    <option value="">Chọn bác sĩ</option>
                    @foreach (var bs in Model.Doctors)
                    {
                        <option value="@bs.manv">@bs.hoten</option>
                    }
                </select>
            </div>
        </div>
        <div>
            <label>Ghi chú / Triệu chứng</label>
            <textarea asp-for="Notes"></textarea>
        </div>
        <div style="margin-top: 16px;">
            <button type="submit" class="btn" id="submitAppointment">Tạo lịch</button>
        </div>
    </form>
</section>

<script>
    (function () {
        const form = document.getElementById("appointmentForm");
        const actionField = document.getElementById("actionField");
        const visitTime = document.getElementById("visitTimeInput");
        const submitBtn = document.getElementById("submitAppointment");

        if (visitTime) {
            visitTime.addEventListener("change", () => {
                actionField.value = "load";
                form.submit();
            });
        }

        if (form) {
            form.addEventListener("submit", (e) => {
                if (e.submitter === submitBtn) {
                    actionField.value = "";
                }
            });
        }
    })();
</script>
